---
import BaseLayout from '../layouts/BaseLayout.astro'
---

<BaseLayout title="Contact" description="Get in touch with SMDurgan.">
  <h1 class="page-title">Get in touch</h1>
  <p>Send a message below. Typically responds within one business day.</p>

  <div id="notice-sent" class="notice ok" hidden>Message sent. Thank you.</div>
  <div id="notice-validation" class="notice err" hidden>
    Please fill in all fields and try again.
  </div>
  <div id="notice-server" class="notice err" hidden>
    Message delivery failed. Please use the contact form to try again.
  </div>

  <div class="form-card section">
    <form id="contact-form">
      <div class="form-field">
        <label for="name">Name</label>
        <input
          id="name"
          name="name"
          placeholder="Your name"
          required
          maxlength="200"
        />
      </div>

      <div class="form-field">
        <label for="email">Email</label>
        <input
          id="email"
          type="email"
          name="email"
          placeholder="you@example.com"
          required
          maxlength="254"
        />
      </div>

      <div class="form-field">
        <label for="message">Message</label>
        <textarea
          id="message"
          name="message"
          placeholder="How can we help?"
          required
          maxlength="5000"
          rows="7"></textarea>
      </div>

      <input
        type="text"
        name="website"
        tabindex="-1"
        autocomplete="off"
        style="position:absolute;left:-9999px"
        aria-hidden="true"
      />

      <button type="submit">Send message</button>
    </form>
  </div>

  <script is:inline>
    ;(function () {
      const form = document.getElementById('contact-form')
      if (!form) return

      function showNotice(id) {
        const notices = document.querySelectorAll('.notice')
        for (let i = 0; i < notices.length; i++) notices[i].hidden = true
        const el = document.getElementById(id)
        if (el) el.hidden = false
      }

      form.addEventListener('submit', function (e) {
        e.preventDefault()
        const btn = form.querySelector('button[type="submit"]')
        btn.disabled = true
        btn.textContent = 'Sending...'

        const payload = {
          name: form.querySelector('#name').value,
          email: form.querySelector('#email').value,
          message: form.querySelector('#message').value,
          website: form.querySelector('[name="website"]').value,
        }

        fetch('/api/contact', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload),
        })
          .then(function (res) {
            if (res.ok) {
              showNotice('notice-sent')
              form.reset()
            } else if (res.status >= 400 && res.status < 500) {
              showNotice('notice-validation')
            } else {
              showNotice('notice-server')
            }
          })
          .catch(function () {
            showNotice('notice-server')
          })
          .finally(function () {
            btn.disabled = false
            btn.textContent = 'Send message'
          })
      })
    })()
  </script>
</BaseLayout>
